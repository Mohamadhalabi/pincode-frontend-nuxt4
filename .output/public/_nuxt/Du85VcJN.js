import{i as Y,e as G,L as H,B as J,C as Q,f as h,k as m,q as X,x as Z,j as I,l as K,c as a,m as v,h as e,t as s,F as $,a as t,d as L,p as ee,r as te,o as l,z as se,A as oe}from"./ClNtL1l2.js";const ne={class:"max-w-3xl mx-auto px-4 py-8"},ie={key:0,class:"text-center text-gray-500"},re={key:1,class:"rounded-xl bg-red-50 text-red-700 px-3 py-2 mb-4 text-sm"},ae={class:"text-2xl sm:text-3xl font-bold mb-2"},le={class:"grid gap-4 sm:grid-cols-2 mb-6"},ce={class:"rounded-2xl border bg-white p-4"},ue={class:"text-xs text-gray-500 mb-1"},de={class:"text-2xl font-bold"},pe={class:"rounded-2xl border bg-white p-4"},ve={class:"text-xs text-gray-500 mb-1"},me={class:"text-2xl font-bold"},_e={class:"rounded-2xl border bg-white p-4 mb-6"},he={class:"text-sm font-semibold mb-2"},xe={class:"whitespace-pre-wrap text-sm text-gray-700"},be={key:0,class:"rounded-xl border border-green-200 bg-green-50 px-3 py-2 mb-4 text-xs text-green-800"},fe={class:"rounded-2xl border bg-white p-4"},ge={class:"text-sm font-semibold mb-3"},ye={class:"block text-md text-gray-600 mb-1"},ke=["onUpdate:modelValue","maxlength","minlength"],we={key:0,class:"mt-1 text-xs text-red-600"},Ce={key:0,class:"mt-2"},Te={key:0,class:"rounded-xl bg-red-50 border border-red-200 text-red-700 px-3 py-2 text-xs space-y-2"},Le={key:1,class:"text-xs text-red-600"},Ne={key:1,class:"text-xs text-emerald-600 mt-1"},qe=["disabled"],Ee={key:0},Se={key:1},Ie={key:2,class:"mt-2 text-xs text-red-600"},$e={key:0,class:"mt-4 rounded-2xl border border-emerald-200 bg-emerald-50 px-4 py-3 text-sm text-emerald-800"},Re={class:"flex items-center justify-between mb-1"},Ve={class:"font-semibold"},Oe={key:0},Ue={key:1},je={key:2},Be=Y({__name:"[slug]",setup(Ae){const{t:i,locale:R}=G(),N=H(),V=J(),{$api:q}=Q(),O=h(()=>N.params.slug),u=m(null),y=m(!1),x=m(null),r=m(null),d=X({});Z(()=>d.vin,o=>{if(!o)return;let c=o.toUpperCase();c=c.replace(/O/gi,"0"),c!==o&&(d.vin=c)});const b=m(!1),_=m(null),f=m(null),g=m("idle"),U=typeof I=="function"?I():null,j=h(()=>U?.user?.value||null),A=localStorage.getItem("auth_token"),k=h(()=>Number(u.value?.wallet_tokens||0)),w=h(()=>Number(u.value?.cost_tokens||0)),D=h(()=>u.value?.behavior||"decoder"),B=h(()=>{if(!u.value||k.value<w.value)return!1;const o=u.value.required_inputs||[];for(const c of o){const n=c.toLowerCase(),p=(d[n]||"").trim();if(!p||n==="vin"&&p.length!==17)return!1}return!0}),F=h(()=>_.value?_.value===i("decoder.vin_unavailable"):!1);K(async()=>{if(!j.value&&!A){V.push("/login?redirect="+encodeURIComponent(N.fullPath));return}await E()});async function E(){y.value=!0,x.value=null;try{const o=await q(`/services/${O.value}`,{method:"GET"});u.value=o,(o.required_inputs||[]).forEach(n=>{const p=n.toLowerCase();p in d||(d[p]="")})}catch(o){console.error(o),x.value=o?.data?.message||o?.message||"Failed to load service"}finally{y.value=!1}}async function P(){if(u.value){_.value=null,f.value=null,b.value=!0,r.value=null,g.value="idle";try{const o={};Object.entries(d).forEach(([C,M])=>{const S=C.toLowerCase();let T=String(M||"").trim();S==="vin"&&(T=T.toUpperCase().replace(/O/gi,"0")),o[S]=T});const n={service_category_id:u.value.id,input_payload:o},p=await q(`/vin-lookups?locale=${R.value}`,{method:"POST",body:n});f.value=p?.message||i("service.submit.success")||"Lookup submitted successfully.",r.value={vin:p?.vin??null,key_code:p?.key_code??null,pin_code:p?.pin_code??null},Object.keys(d).forEach(C=>d[C]=""),await E()}catch(o){console.error(o),_.value=o?.data?.message||o?.message||i("service.submit.error")||"Failed to submit lookup."}finally{b.value=!1}}}function W(){const c="+971504429045".replace(/\D/g,""),n=["PIN Code request",u.value?.name?`Service: ${u.value.name}`:"",d.vin?`VIN: ${d.vin}`:""].filter(Boolean),p=`https://wa.me/${c}?text=${encodeURIComponent(n.join(`
`))}`;window.open(p,"_blank")}async function z(){if(!r.value)return;const o=[];r.value.vin&&o.push(`VIN: ${r.value.vin}`),r.value.key_code&&o.push(`KEYCODE: ${r.value.key_code}`),r.value.pin_code&&o.push(`PINCODE: ${r.value.pin_code}`);const c=o.join(`
`);try{await navigator.clipboard.writeText(c),g.value="copied",setTimeout(()=>{g.value="idle"},2e3)}catch(n){console.error("Clipboard error",n)}}return(o,c)=>(l(),a("div",ne,[e(y)?(l(),a("div",ie,s(e(i)("common.loading")||"Loading…"),1)):e(x)?(l(),a("div",re,s(e(x)),1)):e(u)?(l(),a($,{key:2},[t("h1",ae,s(e(u).name),1),t("div",le,[t("div",ce,[t("div",ue,s(e(i)("service.walletTokens")||"Available Tokens"),1),t("div",de,s(e(k)),1)]),t("div",pe,[t("div",ve,s(e(i)("service.costTokens")||"Required Tokens"),1),t("div",me,s(e(w)),1)])]),t("div",_e,[t("h2",he,s(e(i)("service.instructions")||"Instructions"),1),t("pre",xe,""+s(e(u).instruction_md||e(i)("service.instructionsEmpty")||"No instructions yet.")+`
        `,1)]),e(D)==="whatsapp"&&e(u).whatsapp_number?(l(),a("div",be,[L(s(e(i)("service.whatsappHint")||"This service is processed via WhatsApp.")+" ",1),c[0]||(c[0]=t("br",null,null,-1)),L(" "+s(e(i)("service.whatsappNumber")||"WhatsApp number:")+" ",1),t("strong",null,s(e(u).whatsapp_number),1)])):v("",!0),t("div",fe,[t("h2",ge,s(e(i)("service.requestTitle")||"Request"),1),t("form",{class:"space-y-3",onSubmit:ee(P,["prevent"])},[(l(!0),a($,null,te(e(u).required_inputs||[],n=>(l(),a("div",{key:n},[t("label",ye,[c[1]||(c[1]=t("span",{class:"text-red-600"},"*",-1)),L(s(n.toUpperCase()),1)]),se(t("input",{"onUpdate:modelValue":p=>e(d)[n.toLowerCase()]=p,type:"text",maxlength:n.toLowerCase()==="vin"?17:null,minlength:n.toLowerCase()==="vin"?17:null,class:"w-full rounded-xl border px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-orange-400",required:""},null,8,ke),[[oe,e(d)[n.toLowerCase()],void 0,{trim:!0}]]),n.toLowerCase()==="vin"&&e(d)[n.toLowerCase()]&&e(d)[n.toLowerCase()].length>0&&e(d)[n.toLowerCase()].length!==17?(l(),a("p",we,s(e(i)("service.vin_size")||"VIN must be exactly 17 characters."),1)):v("",!0)]))),128)),e(_)?(l(),a("div",Ce,[e(F)?(l(),a("div",Te,[t("div",null,s(e(_)),1),t("button",{type:"button",class:"inline-flex items-center rounded-lg bg-green-500 text-white px-3 py-1 text-xs font-medium hover:bg-green-600",onClick:W},s(e(i)("common.contact_whatsapp")||"Contact us on WhatsApp"),1)])):(l(),a("div",Le,s(e(_)),1))])):v("",!0),e(f)?(l(),a("div",Ne,s(e(f)),1)):v("",!0),t("button",{type:"submit",class:"mt-2 inline-flex items-center justify-center rounded-xl bg-orange-500 text-white px-4 py-2 text-sm font-medium hover:bg-orange-600 transition disabled:opacity-50 disabled:cursor-not-allowed",disabled:e(b)||!e(B)},[e(b)?(l(),a("span",Se,s(e(i)("common.loading")||"Submitting…"),1)):(l(),a("span",Ee,s(e(i)("service.submit")||"Submit Request"),1))],8,qe),e(k)<e(w)?(l(),a("p",Ie,s(e(i)("service.notEnoughTokens")||"You don’t have enough tokens for this service."),1)):v("",!0)],32),e(r)&&(e(r).vin||e(r).pin_code||e(r).key_code)?(l(),a("div",$e,[t("div",Re,[t("div",Ve,s(e(i)("service.resultTitle")||"Decoded Result"),1),t("button",{type:"button",class:"text-xs font-medium underline underline-offset-2",onClick:z},s(e(g)==="copied"?e(i)("common.copied")||"Copied":e(i)("common.copy")||"Copy"),1)]),e(r).vin?(l(),a("div",Oe,[t("strong",null,s(e(r).vin),1)])):v("",!0),e(r).key_code?(l(),a("div",Ue,[t("strong",null,s(e(r).key_code),1)])):v("",!0),e(r).pin_code?(l(),a("div",je,[t("strong",null,s(e(r).pin_code),1)])):v("",!0)])):v("",!0)])],64)):v("",!0)]))}});export{Be as default};
