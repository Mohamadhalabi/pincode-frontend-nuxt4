import{_ as nt}from"./Q7S53kZ7.js";import{_ as ct}from"./DsN7wOsT.js";import{i as dt,e as it,A as rt,B as ut,j as W,f as A,k as i,l as _t,q as pt,c as d,a as t,m as _,t as s,h as e,D as w,p as vt,y as D,z as U,F as N,r as E,o as c,n as X,w as mt,d as q}from"./CNQ7mN1-.js";import{_ as ht}from"./DlAUqK2U.js";const ft={class:"max-w-6xl mx-auto px-4 py-8"},bt={class:"flex items-center justify-between mb-8"},gt={class:"text-3xl font-extrabold text-gray-900 tracking-tight"},yt={class:"border-b border-gray-200 mb-8"},xt={class:"-mb-px flex gap-6 text-sm font-medium"},kt={key:0,class:"space-y-6"},wt={key:0,class:"alert alert--bad"},Nt={class:"grid gap-5 md:grid-cols-3"},Ct={class:"stat-card"},St={class:"stat-label"},Tt={class:"stat-value"},$t={class:"stat-card"},Pt={class:"stat-label"},At={class:"stat-value"},Et={class:"stat-sub text-[#0e5e6f]"},It={class:"stat-card"},Vt={class:"stat-label"},Ot={class:"stat-value"},Bt={class:"grid gap-5 md:grid-cols-2"},Ft={class:"stat-card border-l-4 border-l-[#0e5e6f]"},Lt={class:"stat-label"},Mt={class:"stat-value text-[#0e5e6f]"},jt={class:"stat-card border-l-4 border-l-[#3adbc4]"},Dt={class:"stat-label"},Ut={class:"stat-value text-[#0e5e6f]"},qt={class:"grid gap-6 md:grid-cols-[2fr_3fr]"},zt={class:"card"},Gt={class:"flex items-center justify-between mb-4 pb-3 border-b border-gray-100"},Ht={class:"text-base font-bold text-gray-900"},Kt={key:0,class:"space-y-4 text-sm"},Qt={class:"field"},Rt={class:"field-label"},Jt={class:"field-value"},Wt={class:"field"},Xt={class:"field-label"},Yt={class:"field-value"},Zt={class:"field"},te={class:"field-label"},ee={class:"field-value"},se={class:"field"},oe={class:"field-label"},ae={class:"field-value"},le={class:"label"},ne={class:"label"},ce={class:"label"},de={key:0,class:"text-xs text-red-600"},ie={key:1,class:"text-xs text-emerald-600"},re=["disabled"],ue={class:"card"},_e={class:"text-base font-bold text-gray-900 mb-4 pb-3 border-b border-gray-100"},pe={key:0,class:"text-sm text-gray-500 italic"},ve={key:1,class:"divide-y divide-gray-100 text-sm"},me={class:"font-bold text-gray-800"},he={class:"text-xs text-gray-500"},fe={class:"text-xl font-black tabular-nums text-[#0e5e6f] bg-[#f0fdfc] px-3 py-1 rounded-lg"},be={key:1,class:"space-y-5"},ge={key:0,class:"alert alert--bad"},ye={class:"card overflow-hidden !p-0"},xe={class:"w-full text-sm"},ke={class:"thead"},we={class:"th"},Ne={class:"th"},Ce={class:"th"},Se={class:"th text-right"},Te={key:0},$e={colspan:"5",class:"px-6 py-10 text-center text-gray-500 italic"},Pe=["onClick"],Ae={class:"td font-bold text-[#0e5e6f]"},Ee={class:"td text-gray-600"},Ie={class:"td"},Ve={class:"td capitalize text-gray-600"},Oe={class:"td text-right font-bold text-[#0e5e6f]"},Be={key:0,class:"bg-gray-50 border-b border-gray-200 shadow-inner"},Fe={colspan:"5",class:"px-6 py-5"},Le={class:"text-xs font-bold text-gray-400 uppercase tracking-wider mb-3"},Me={key:0,class:"text-xs text-gray-500"},je={key:1,class:"space-y-3"},De={class:"flex items-center gap-3 min-w-0"},Ue={class:"min-w-0"},qe={key:1,class:"font-medium line-clamp-1"},ze={class:"text-xs text-gray-500 mt-0.5"},Ge={class:"font-medium"},He={class:"font-medium"},Ke={class:"text-sm font-bold text-gray-900 tabular-nums"},Qe={key:1,class:"flex items-center justify-end gap-2 text-xs font-medium"},Re=["disabled"],Je={class:"px-2"},We=["disabled"],Xe={key:2,class:"space-y-4"},Ye={key:0,class:"alert alert--bad"},Ze={class:"card overflow-hidden !p-0"},ts={class:"w-full text-sm"},es={class:"thead"},ss={class:"th"},os={class:"th"},as={class:"th"},ls={class:"th text-right"},ns={class:"th"},cs={key:0},ds={colspan:"6",class:"px-6 py-10 text-center text-gray-500 italic"},is={class:"td font-bold text-[#0e5e6f]"},rs={class:"td font-mono text-xs sm:text-sm tracking-wide bg-gray-50 rounded px-2 py-1"},us={class:"td font-medium text-gray-700"},_s={class:"td"},ps={class:"td text-right font-bold tabular-nums text-gray-900"},vs={class:"td text-gray-500"},ms={key:1,class:"flex items-center justify-end gap-2 text-xs font-medium"},hs=["disabled"],fs={class:"px-2"},bs=["disabled"],gs=dt({__name:"account",setup(ys){const{t:a}=it(),z=rt(),{$api:C}=ut(),b=typeof W=="function"?W():null,G=A(()=>b?.user?.value||null),H=A(()=>localStorage.getItem("auth_token")||localStorage.getItem("pk:token")),h=i("overview"),I=i(null);function V(n){h.value=n}_t(()=>{!G.value&&!H.value?z.push("/login?redirect=/account"):(et(),B(),L())});async function Y(){try{await b?.logout?.()}finally{z.push("/")}}const K=i(!1),S=i(null),p=i(null),g=i(null),y=i([]),Z=A(()=>{const n=y.value.find(o=>o.service_slug==="kia-hyundai-before-2017");return n?Number(n.tokens||0):0}),tt=A(()=>{const n=y.value.find(o=>o.service_slug==="kia-hyundai-after-2017");return n?Number(n.tokens||0):0}),x=i(!1),T=i(!1),f=i(null),k=i(null),r=pt({name:"",email:"",phone:""});async function et(){K.value=!0,S.value=null;try{const n=await C("/account/overview",{method:"GET"});p.value=n.profile||null,g.value=n.stats||null,y.value=Array.isArray(n.wallets)?n.wallets:[],p.value&&(r.name=p.value.name||"",r.email=p.value.email||"",r.phone=p.value.phone||"")}catch(n){S.value=n?.data?.message||n?.message||"Failed to load overview"}finally{K.value=!1}}async function st(){if(f.value=null,k.value=null,!r.name||!r.email){f.value="Name and email are required.";return}T.value=!0;try{const n=await C("/account/profile",{method:"PUT",body:{...r,phone:r.phone||null}});p.value=n.user||p.value,k.value=a("account.profile.updated")||"Profile updated successfully.",x.value=!1,b&&typeof b.reloadUser=="function"&&await b.reloadUser()}catch(n){f.value=n?.data?.message||n?.message||a("account.profile.updateFailed")||"Failed to update profile."}finally{T.value=!1}}const Q=i(!1),$=i(null),O=i([]),v=i({current_page:1,last_page:1});async function B(n=1){Q.value=!0,$.value=null;try{const o=await C(`/account/orders?page=${n}`,{method:"GET"});O.value=Array.isArray(o.data)?o.data:[],v.value=o.meta||{current_page:1,last_page:1}}catch(o){$.value=o?.data?.message||o?.message||"Failed to load orders"}finally{Q.value=!1}}function ot(n){I.value=I.value===n?null:n}const R=i(!1),P=i(null),F=i([]),m=i({current_page:1,last_page:1});async function L(n=1){R.value=!0,P.value=null;try{const o=await C(`/account/lookups?page=${n}`,{method:"GET"});F.value=Array.isArray(o.data)?o.data:[],m.value=o.meta||{current_page:1,last_page:1}}catch(o){P.value=o?.data?.message||o?.message||"Failed to load VIN lookups"}finally{R.value=!1}}const M=n=>n?new Date(n).toLocaleString():"",j=n=>"$"+Number(n||0).toFixed(2),J=n=>{const o=(n||"").toLowerCase();return o==="completed"||o==="paid"?"badge badge--ok":o==="failed"||o==="cancelled"?"badge badge--bad":"badge badge--wait"};return(n,o)=>{const at=nt,lt=ct;return c(),d("div",ft,[t("div",bt,[t("div",null,[t("h1",gt,s(e(a)("account.title")||"My account"),1),o[11]||(o[11]=t("p",{class:"text-sm text-gray-500 mt-1"},"Manage your profile, orders, and tokens.",-1))]),e(G)||e(H)?(c(),d("button",{key:0,class:"btn-ghost text-xs sm:text-sm",onClick:Y},s(e(a)("auth.logout")||"Logout"),1)):_("",!0)]),t("div",yt,[t("nav",xt,[t("button",{type:"button",class:w(["tab-btn",e(h)==="overview"?"tab-btn--active":""]),onClick:o[0]||(o[0]=l=>V("overview"))},s(e(a)("account.tabs.overview")||"Overview"),3),t("button",{type:"button",class:w(["tab-btn",e(h)==="orders"?"tab-btn--active":""]),onClick:o[1]||(o[1]=l=>V("orders"))},s(e(a)("account.tabs.orders")||"Orders"),3),t("button",{type:"button",class:w(["tab-btn",e(h)==="lookups"?"tab-btn--active":""]),onClick:o[2]||(o[2]=l=>V("lookups"))},s(e(a)("account.tabs.lookups")||"VIN lookups"),3)])]),e(h)==="overview"?(c(),d("section",kt,[e(S)?(c(),d("div",wt,s(e(S)),1)):_("",!0),t("div",Nt,[t("div",Ct,[t("div",St,s(e(a)("account.cards.totalOrders")||"Total orders"),1),t("div",Tt,s(e(g)?.total_orders??0),1)]),t("div",$t,[t("div",Pt,s(e(a)("account.cards.totalLookups")||"VIN lookups"),1),t("div",At,s(e(g)?.total_lookups??0),1),t("div",Et,s(e(a)("account.cards.completed")||"Completed")+": "+s(e(g)?.completed_lookups??0),1)]),t("div",It,[t("div",Vt,s(e(a)("account.cards.tokensSpent")||"Tokens spent"),1),t("div",Ot,s(e(g)?.total_tokens_spent??0),1)])]),t("div",Bt,[t("div",Ft,[t("div",Lt,s(e(a)("account.cards.kiaBefore")||"Kia / Hyundai tokens (before 2017)"),1),t("div",Mt,s(e(Z)),1)]),t("div",jt,[t("div",Dt,s(e(a)("account.cards.kiaAfter")||"Kia / Hyundai tokens (2017 and after)"),1),t("div",Ut,s(e(tt)),1)])]),t("div",qt,[t("div",zt,[t("div",Gt,[t("h2",Ht,s(e(a)("account.profile.title")||"Profile"),1),t("button",{class:"text-xs font-semibold text-[#0e5e6f] hover:text-[#3adbc4] hover:underline",onClick:o[3]||(o[3]=l=>{x.value=!e(x),f.value=null,k.value=null})},s(e(x)?e(a)("common.cancel")||"Cancel":e(a)("account.profile.edit")||"Edit"),1)]),e(x)?(c(),d("form",{key:1,class:"space-y-4 text-sm",onSubmit:vt(st,["prevent"])},[t("div",null,[t("label",le,s(e(a)("common.name")||"Name"),1),D(t("input",{"onUpdate:modelValue":o[4]||(o[4]=l=>e(r).name=l),class:"input",required:""},null,512),[[U,e(r).name,void 0,{trim:!0}]])]),t("div",null,[t("label",ne,s(e(a)("common.email")||"Email"),1),D(t("input",{"onUpdate:modelValue":o[5]||(o[5]=l=>e(r).email=l),class:"input",type:"email",required:""},null,512),[[U,e(r).email,void 0,{trim:!0}]])]),t("div",null,[t("label",ce,s(e(a)("common.phone")||"Phone"),1),D(t("input",{"onUpdate:modelValue":o[6]||(o[6]=l=>e(r).phone=l),class:"input"},null,512),[[U,e(r).phone,void 0,{trim:!0}]])]),e(f)?(c(),d("p",de,s(e(f)),1)):_("",!0),e(k)?(c(),d("p",ie,s(e(k)),1)):_("",!0),t("button",{class:"btn w-full",disabled:e(T)},s(e(T)?e(a)("common.loading")||"Saving…":e(a)("common.save")||"Save Changes"),9,re)],32)):(c(),d("div",Kt,[t("div",Qt,[t("div",Rt,s(e(a)("common.name")||"Name"),1),t("div",Jt,s(e(p)?.name||"-"),1)]),t("div",Wt,[t("div",Xt,s(e(a)("common.email")||"Email"),1),t("div",Yt,s(e(p)?.email||"-"),1)]),t("div",Zt,[t("div",te,s(e(a)("common.phone")||"Phone"),1),t("div",ee,s(e(p)?.phone||"-"),1)]),t("div",se,[t("div",oe,s(e(a)("account.profile.memberSince")||"Member since"),1),t("div",ae,s(e(p)?.created_at?M(e(p).created_at):"-"),1)])]))]),t("div",ue,[t("h2",_e,s(e(a)("account.wallets.title")||"Service wallets"),1),e(y).length?(c(),d("ul",ve,[(c(!0),d(N,null,E(e(y),l=>(c(),d("li",{key:l.id,class:"flex items-center justify-between py-3"},[t("div",null,[t("div",me,s(l.service_name||"Service #"+l.service_id),1),t("div",he,s(e(a)("account.wallets.tokens")||"Current Balance"),1)]),t("div",fe,s(l.tokens),1)]))),128))])):(c(),d("div",pe,s(e(a)("account.wallets.empty")||"No wallets found."),1))])])])):e(h)==="orders"?(c(),d("section",be,[e($)?(c(),d("div",ge,s(e($)),1)):_("",!0),t("div",ye,[t("table",xe,[t("thead",ke,[t("tr",null,[o[12]||(o[12]=t("th",{class:"th"},"#",-1)),t("th",we,s(e(a)("account.orders.date")||"Date"),1),t("th",Ne,s(e(a)("account.orders.status")||"Status"),1),t("th",Ce,s(e(a)("account.orders.payment")||"Payment"),1),t("th",Se,s(e(a)("account.orders.total")||"Total"),1)])]),t("tbody",null,[e(O).length?_("",!0):(c(),d("tr",Te,[t("td",$e,s(e(a)("account.orders.empty")||"No orders found."),1)])),(c(!0),d(N,null,E(e(O),l=>(c(),d(N,{key:l.id},[t("tr",{class:"tr cursor-pointer hover:bg-[#f0fdfc]/50 transition-colors",onClick:u=>ot(l.id)},[t("td",Ae,"#"+s(l.id),1),t("td",Ee,s(M(l.created_at)),1),t("td",Ie,[t("span",{class:w(J(l.status))},s(l.status),3)]),t("td",Ve,s(l.payment_method),1),t("td",Oe,s(j(l.subtotal)),1)],8,Pe),e(I)===l.id?(c(),d("tr",Be,[t("td",Fe,[t("div",Le,s(e(a)("account.orders.items")||"Order items"),1),l.items?.length?(c(),d("ul",je,[(c(!0),d(N,null,E(l.items,u=>(c(),d("li",{key:u.id,class:"flex items-center justify-between gap-4 bg-white border border-gray-200 rounded-xl p-3 shadow-sm"},[t("div",De,[u.image_url?(c(),X(at,{key:0,src:u.image_url,class:"h-12 w-12 rounded-lg border border-gray-100 bg-white object-contain p-1",format:"webp",alt:""},null,8,["src"])):_("",!0),t("div",Ue,[u.product_slug?(c(),X(lt,{key:0,to:`/product/${u.product_slug}`,class:"font-semibold text-[#0e5e6f] hover:text-[#3adbc4] hover:underline line-clamp-1 transition-colors"},{default:mt(()=>[q(s(u.product_name||"Product #"+u.product_id),1)]),_:2},1032,["to"])):(c(),d("div",qe,s(u.product_name||"Product #"+u.product_id),1)),t("div",ze,[o[13]||(o[13]=q(" Qty: ",-1)),t("span",Ge,s(u.qty),1),o[14]||(o[14]=q(" · Unit: ",-1)),t("span",He,s(j(u.price)),1)])])]),t("div",Ke,s(j(u.line_total)),1)]))),128))])):(c(),d("div",Me,"—"))])])):_("",!0)],64))),128))])])]),e(v).last_page>1?(c(),d("div",Qe,[t("button",{class:"pager-btn",disabled:e(v).current_page<=1,onClick:o[7]||(o[7]=l=>B(e(v).current_page-1))},"‹ Prev",8,Re),t("span",Je,s(e(v).current_page)+" / "+s(e(v).last_page),1),t("button",{class:"pager-btn",disabled:e(v).current_page>=e(v).last_page,onClick:o[8]||(o[8]=l=>B(e(v).current_page+1))},"Next ›",8,We)])):_("",!0)])):e(h)==="lookups"?(c(),d("section",Xe,[e(P)?(c(),d("div",Ye,s(e(P)),1)):_("",!0),t("div",Ze,[t("table",ts,[t("thead",es,[t("tr",null,[o[15]||(o[15]=t("th",{class:"th"},"#",-1)),t("th",ss,s(e(a)("account.lookups.vin")||"VIN"),1),t("th",os,s(e(a)("account.lookups.service")||"Service"),1),t("th",as,s(e(a)("account.lookups.status")||"Status"),1),t("th",ls,s(e(a)("account.lookups.cost")||"Tokens"),1),t("th",ns,s(e(a)("account.lookups.date")||"Date"),1)])]),t("tbody",null,[e(F).length?_("",!0):(c(),d("tr",cs,[t("td",ds,s(e(a)("account.lookups.empty")||"No VIN lookups yet."),1)])),(c(!0),d(N,null,E(e(F),l=>(c(),d("tr",{key:l.id,class:"tr hover:bg-gray-50 transition-colors"},[t("td",is,"#"+s(l.id),1),t("td",rs,s(l.vin||"—"),1),t("td",us,s(l.service_name||"Service #"+l.service_id),1),t("td",_s,[t("span",{class:w(J(l.status))},s(l.status),3)]),t("td",ps,s(l.cost_tokens),1),t("td",vs,s(M(l.created_at)),1)]))),128))])])]),e(m).last_page>1?(c(),d("div",ms,[t("button",{class:"pager-btn",disabled:e(m).current_page<=1,onClick:o[9]||(o[9]=l=>L(e(m).current_page-1))},"‹ Prev",8,hs),t("span",fs,s(e(m).current_page)+" / "+s(e(m).last_page),1),t("button",{class:"pager-btn",disabled:e(m).current_page>=e(m).last_page,onClick:o[10]||(o[10]=l=>L(e(m).current_page+1))},"Next ›",8,bs)])):_("",!0)])):_("",!0)])}}}),Cs=ht(gs,[["__scopeId","data-v-6c7b7956"]]);export{Cs as default};
