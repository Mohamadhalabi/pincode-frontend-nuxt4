import{i as X,e as Y,B as Z,C as ee,j as L,f as V,k as c,l as te,q as se,c as r,a as e,m as p,t as s,h as t,y as M,p as oe,z as I,A as O,F as j,r as B,o as d}from"./ClNtL1l2.js";import{_ as ae}from"./DlAUqK2U.js";const ne={class:"max-w-6xl mx-auto px-4 py-8"},le={class:"text-2xl sm:text-3xl font-bold mb-6"},re={class:"border-b mb-4"},de={class:"-mb-px flex gap-4 text-sm"},ce={key:0},ie={key:0,class:"rounded-xl bg-red-50 text-red-700 px-3 py-2 mb-3 text-sm"},ue={class:"grid gap-4 md:grid-cols-3 mb-5"},pe={class:"rounded-2xl border bg-white p-4"},_e={class:"text-xs text-gray-500 mb-1"},xe={class:"text-2xl font-bold"},me={class:"rounded-2xl border bg-white p-4"},ve={class:"text-xs text-gray-500 mb-1"},ye={class:"text-2xl font-bold"},he={class:"text-xs text-gray-500 mt-1"},be={class:"rounded-2xl border bg-white p-4"},fe={class:"text-xs text-gray-500 mb-1"},ge={class:"text-2xl font-bold"},ke={class:"grid gap-4 md:grid-cols-2 mb-5"},we={class:"rounded-2xl border bg-white p-4"},Ne={class:"text-xs text-gray-500 mb-1"},Se={class:"text-2xl font-bold"},Te={class:"rounded-2xl border bg-white p-4"},Ce={class:"text-xs text-gray-500 mb-1"},Ae={class:"text-2xl font-bold"},Ee={class:"grid gap-4 md:grid-cols-[2fr_3fr]"},$e={class:"rounded-2xl border bg-white p-4"},Fe={class:"flex items-center justify-between mb-3"},Pe={class:"text-sm font-semibold"},Ve={key:0,class:"space-y-2 text-sm"},Me={class:"text-gray-500"},Ie={class:"font-medium"},Oe={class:"text-gray-500"},je={class:"font-medium"},Be={class:"text-gray-500"},De={class:"font-medium"},Ue={class:"text-gray-500"},ze={class:"font-medium"},Le={class:"block text-xs text-gray-600 mb-1"},qe={class:"block text-xs text-gray-600 mb-1"},Ge={class:"block text-xs text-gray-600 mb-1"},He={key:0,class:"text-xs text-red-600"},Ke={key:1,class:"text-xs text-emerald-600"},Re=["disabled"],Je={key:0},Qe={key:1},We={class:"rounded-2xl border bg-white p-4"},Xe={class:"text-sm font-semibold mb-3"},Ye={key:0,class:"text-xs text-gray-500"},Ze={key:1,class:"divide-y text-sm"},et={class:"font-medium"},tt={class:"text-xs text-gray-500"},st={class:"text-lg font-bold"},ot={key:1},at={key:0,class:"rounded-xl bg-red-50 text-red-700 px-3 py-2 mb-3 text-sm"},nt={class:"rounded-2xl border bg-white overflow-hidden w-full"},lt={class:"w-full min-w-full border-collapse text-sm"},rt={class:"bg-gray-50 text-xs uppercase text-gray-500"},dt={class:"px-6 py-2 text-left"},ct={class:"px-6 py-2 text-left"},it={class:"px-6 py-2 text-left"},ut={class:"px-6 py-2 text-right"},pt={key:0},_t={colspan:"5",class:"px-6 py-4 text-center text-gray-500"},xt={class:"px-6 py-2"},mt={class:"px-6 py-2"},vt={class:"px-6 py-2 capitalize"},yt={class:"px-6 py-2 capitalize"},ht={class:"px-6 py-2 text-right font-medium"},bt={key:1,class:"flex items-center justify-end gap-2 mt-3 text-xs"},ft=["disabled"],gt=["disabled"],kt={key:2},wt={key:0,class:"rounded-xl bg-red-50 text-red-700 px-3 py-2 mb-3 text-sm"},Nt={class:"rounded-2xl border bg-white overflow-hidden w-full"},St={class:"w-full min-w-full border-collapse text-sm"},Tt={class:"bg-gray-50 text-xs uppercase text-gray-500"},Ct={class:"px-6 py-2 text-left"},At={class:"px-6 py-2 text-left"},Et={class:"px-6 py-2 text-right"},$t={class:"px-6 py-2 text-left"},Ft={key:0},Pt={colspan:"5",class:"px-6 py-4 text-center text-gray-500"},Vt={class:"px-6 py-2"},Mt={class:"px-6 py-2"},It={class:"px-6 py-2 capitalize"},Ot={class:"px-6 py-2 text-right font-medium"},jt={class:"px-6 py-2"},Bt={key:1,class:"flex items-center justify-end gap-2 mt-3 text-xs"},Dt=["disabled"],Ut=["disabled"],zt=X({__name:"account",setup(Lt){const{t:a}=Y(),q=Z(),{$api:g}=ee(),k=typeof L=="function"?L():null,G=V(()=>k?.user?.value||null),H=localStorage.getItem("auth_token"),m=c("overview");function C(n){m.value=n}te(()=>{!G.value&&!H?q.push("/login?redirect=/account"):(J(),E(),F())});const D=c(!1),w=c(null),u=c(null),y=c(null),h=c([]),K=V(()=>{const n=h.value.find(o=>o.service_slug==="kia-hyundai-before-2017");return n?Number(n.tokens||0):0}),R=V(()=>{const n=h.value.find(o=>o.service_slug==="kia-hyundai-after-2017");return n?Number(n.tokens||0):0}),b=c(!1),N=c(!1),v=c(null),f=c(null),i=se({name:"",email:"",phone:""});async function J(){D.value=!0,w.value=null;try{const n=await g("/account/overview",{method:"GET"});u.value=n.profile||null,y.value=n.stats||null,h.value=Array.isArray(n.wallets)?n.wallets:[],u.value&&(i.name=u.value.name||"",i.email=u.value.email||"",i.phone=u.value.phone||"")}catch(n){console.error(n),w.value=n?.data?.message||n?.message||"Failed to load overview"}finally{D.value=!1}}async function Q(){if(v.value=null,f.value=null,!i.name||!i.email){v.value="Name and email are required.";return}N.value=!0;try{const n=await g("/account/profile",{method:"PUT",body:{name:i.name,email:i.email,phone:i.phone||null}});u.value=n.user||{...u.value||{},name:i.name,email:i.email,phone:i.phone},f.value=a("account.profile.updated")||"Profile updated successfully.",b.value=!1,k&&typeof k.fetchUser=="function"&&await k.fetchUser()}catch(n){console.error(n),v.value=n?.data?.message||n?.message||a("account.profile.updateFailed")||"Failed to update profile."}finally{N.value=!1}}const U=c(!1),S=c(null),A=c([]),_=c({current_page:1,last_page:1});async function E(n=1){U.value=!0,S.value=null;try{const o=await g(`/account/orders?page=${n}`,{method:"GET"});A.value=Array.isArray(o.data)?o.data:[],_.value=o.meta||{current_page:1,last_page:1}}catch(o){console.error(o),S.value=o?.data?.message||o?.message||"Failed to load orders"}finally{U.value=!1}}const z=c(!1),T=c(null),$=c([]),x=c({current_page:1,last_page:1});async function F(n=1){z.value=!0,T.value=null;try{const o=await g(`/account/lookups?page=${n}`,{method:"GET"});$.value=Array.isArray(o.data)?o.data:[],x.value=o.meta||{current_page:1,last_page:1}}catch(o){console.error(o),T.value=o?.data?.message||o?.message||"Failed to load VIN lookups"}finally{z.value=!1}}const P=n=>n?new Date(n).toLocaleString():"",W=n=>"$"+Number(n||0).toFixed(2);return(n,o)=>(d(),r("div",ne,[e("h1",le,s(t(a)("account.title")||"My account"),1),e("div",re,[e("nav",de,[e("button",{type:"button",class:M(["border-b-2 pb-2 px-1",t(m)==="overview"?"border-orange-500 text-orange-600 font-semibold":"border-transparent text-gray-500 hover:text-gray-800"]),onClick:o[0]||(o[0]=l=>C("overview"))},s(t(a)("account.tabs.overview")||"Overview"),3),e("button",{type:"button",class:M(["border-b-2 pb-2 px-1",t(m)==="orders"?"border-orange-500 text-orange-600 font-semibold":"border-transparent text-gray-500 hover:text-gray-800"]),onClick:o[1]||(o[1]=l=>C("orders"))},s(t(a)("account.tabs.orders")||"Orders"),3),e("button",{type:"button",class:M(["border-b-2 pb-2 px-1",t(m)==="lookups"?"border-orange-500 text-orange-600 font-semibold":"border-transparent text-gray-500 hover:text-gray-800"]),onClick:o[2]||(o[2]=l=>C("lookups"))},s(t(a)("account.tabs.lookups")||"VIN lookups"),3)])]),t(m)==="overview"?(d(),r("section",ce,[t(w)?(d(),r("div",ie,s(t(w)),1)):p("",!0),e("div",ue,[e("div",pe,[e("div",_e,s(t(a)("account.cards.totalOrders")||"Total orders"),1),e("div",xe,s(t(y)?.total_orders??0),1)]),e("div",me,[e("div",ve,s(t(a)("account.cards.totalLookups")||"VIN lookups"),1),e("div",ye,s(t(y)?.total_lookups??0),1),e("div",he,s(t(a)("account.cards.completed")||"Completed")+": "+s(t(y)?.completed_lookups??0),1)]),e("div",be,[e("div",fe,s(t(a)("account.cards.tokensSpent")||"Tokens spent"),1),e("div",ge,s(t(y)?.total_tokens_spent??0),1)])]),e("div",ke,[e("div",we,[e("div",Ne,s(t(a)("account.cards.kiaBefore")||"Kia / Hyundai tokens (before 2017)"),1),e("div",Se,s(t(K)),1)]),e("div",Te,[e("div",Ce,s(t(a)("account.cards.kiaAfter")||"Kia / Hyundai tokens (2017 and after)"),1),e("div",Ae,s(t(R)),1)])]),e("div",Ee,[e("div",$e,[e("div",Fe,[e("h2",Pe,s(t(a)("account.profile.title")||"Profile"),1),e("button",{type:"button",class:"text-xs font-medium text-orange-600 hover:text-orange-700",onClick:o[3]||(o[3]=()=>{b.value=!t(b),v.value=null,f.value=null})},s(t(b)?t(a)("common.cancel")||"Cancel":t(a)("account.profile.edit")||"Edit"),1)]),t(b)?(d(),r("form",{key:1,class:"space-y-3 text-sm",onSubmit:oe(Q,["prevent"])},[e("div",null,[e("label",Le,s(t(a)("common.name")||"Name"),1),I(e("input",{"onUpdate:modelValue":o[4]||(o[4]=l=>t(i).name=l),type:"text",class:"w-full rounded-xl border px-3 py-2 focus:outline-none focus:ring-2 focus:ring-orange-400",required:""},null,512),[[O,t(i).name,void 0,{trim:!0}]])]),e("div",null,[e("label",qe,s(t(a)("common.email")||"Email"),1),I(e("input",{"onUpdate:modelValue":o[5]||(o[5]=l=>t(i).email=l),type:"email",class:"w-full rounded-xl border px-3 py-2 focus:outline-none focus:ring-2 focus:ring-orange-400",required:""},null,512),[[O,t(i).email,void 0,{trim:!0}]])]),e("div",null,[e("label",Ge,s(t(a)("common.phone")||"Phone"),1),I(e("input",{"onUpdate:modelValue":o[6]||(o[6]=l=>t(i).phone=l),type:"text",class:"w-full rounded-xl border px-3 py-2 focus:outline-none focus:ring-2 focus:ring-orange-400"},null,512),[[O,t(i).phone,void 0,{trim:!0}]])]),t(v)?(d(),r("div",He,s(t(v)),1)):p("",!0),t(f)?(d(),r("div",Ke,s(t(f)),1)):p("",!0),e("button",{type:"submit",class:"inline-flex items-center justify-center rounded-xl bg-orange-500 text-white px-4 py-2 text-xs font-medium hover:bg-orange-600 transition disabled:opacity-60 disabled:cursor-not-allowed",disabled:t(N)},[t(N)?(d(),r("span",Qe,s(t(a)("common.loading")||"Saving…"),1)):(d(),r("span",Je,s(t(a)("common.save")||"Save"),1))],8,Re)],32)):(d(),r("div",Ve,[e("div",null,[e("div",Me,s(t(a)("common.name")||"Name"),1),e("div",Ie,s(t(u)?.name||"-"),1)]),e("div",null,[e("div",Oe,s(t(a)("common.email")||"Email"),1),e("div",je,s(t(u)?.email||"-"),1)]),e("div",null,[e("div",Be,s(t(a)("common.phone")||"Phone"),1),e("div",De,s(t(u)?.phone||"-"),1)]),e("div",null,[e("div",Ue,s(t(a)("account.profile.memberSince")||"Member since"),1),e("div",ze,s(t(u)?.created_at?P(t(u).created_at):"-"),1)])]))]),e("div",We,[e("h2",Xe,s(t(a)("account.wallets.title")||"Service wallets"),1),t(h).length?(d(),r("ul",Ze,[(d(!0),r(j,null,B(t(h),l=>(d(),r("li",{key:l.id,class:"flex items-center justify-between py-2"},[e("div",null,[e("div",et,s(l.service_name||"Service #"+l.service_id),1),e("div",tt,s(t(a)("account.wallets.tokens")||"Tokens"),1)]),e("div",st,s(l.tokens),1)]))),128))])):(d(),r("div",Ye,s(t(a)("account.wallets.empty")||"No wallets yet."),1))])])])):t(m)==="orders"?(d(),r("section",ot,[t(S)?(d(),r("div",at,s(t(S)),1)):p("",!0),e("div",nt,[e("table",lt,[e("thead",rt,[e("tr",null,[o[11]||(o[11]=e("th",{class:"px-6 py-2 text-left"},"#",-1)),e("th",dt,s(t(a)("account.orders.date")||"Date"),1),e("th",ct,s(t(a)("account.orders.status")||"Status"),1),e("th",it,s(t(a)("account.orders.payment")||"Payment"),1),e("th",ut,s(t(a)("account.orders.total")||"Total"),1)])]),e("tbody",null,[t(A).length?p("",!0):(d(),r("tr",pt,[e("td",_t,s(t(a)("account.orders.empty")||"No orders yet."),1)])),(d(!0),r(j,null,B(t(A),l=>(d(),r("tr",{key:l.id,class:"border-t"},[e("td",xt,"#"+s(l.id),1),e("td",mt,s(P(l.created_at)),1),e("td",vt,s(l.status),1),e("td",yt,s(l.payment_method),1),e("td",ht,s(W(l.subtotal)),1)]))),128))])])]),t(_).last_page>1?(d(),r("div",bt,[e("button",{type:"button",class:"px-2 py-1 rounded border",disabled:t(_).current_page<=1,onClick:o[7]||(o[7]=l=>E(t(_).current_page-1))}," ‹ ",8,ft),e("span",null,s(t(_).current_page)+" / "+s(t(_).last_page),1),e("button",{type:"button",class:"px-2 py-1 rounded border",disabled:t(_).current_page>=t(_).last_page,onClick:o[8]||(o[8]=l=>E(t(_).current_page+1))}," › ",8,gt)])):p("",!0)])):t(m)==="lookups"?(d(),r("section",kt,[t(T)?(d(),r("div",wt,s(t(T)),1)):p("",!0),e("div",Nt,[e("table",St,[e("thead",Tt,[e("tr",null,[o[12]||(o[12]=e("th",{class:"px-6 py-2 text-left"},"#",-1)),e("th",Ct,s(t(a)("account.lookups.service")||"Service"),1),e("th",At,s(t(a)("account.lookups.status")||"Status"),1),e("th",Et,s(t(a)("account.lookups.cost")||"Tokens"),1),e("th",$t,s(t(a)("account.lookups.date")||"Date"),1)])]),e("tbody",null,[t($).length?p("",!0):(d(),r("tr",Ft,[e("td",Pt,s(t(a)("account.lookups.empty")||"No VIN lookups yet."),1)])),(d(!0),r(j,null,B(t($),l=>(d(),r("tr",{key:l.id,class:"border-t"},[e("td",Vt,"#"+s(l.id),1),e("td",Mt,s(l.service_name||"Service #"+l.service_id),1),e("td",It,s(l.status),1),e("td",Ot,s(l.cost_tokens),1),e("td",jt,s(P(l.created_at)),1)]))),128))])])]),t(x).last_page>1?(d(),r("div",Bt,[e("button",{type:"button",class:"px-2 py-1 rounded border",disabled:t(x).current_page<=1,onClick:o[9]||(o[9]=l=>F(t(x).current_page-1))}," ‹ ",8,Dt),e("span",null,s(t(x).current_page)+" / "+s(t(x).last_page),1),e("button",{type:"button",class:"px-2 py-1 rounded border",disabled:t(x).current_page>=t(x).last_page,onClick:o[10]||(o[10]=l=>F(t(x).current_page+1))}," › ",8,Ut)])):p("",!0)])):p("",!0)]))}}),Ht=ae(zt,[["__scopeId","data-v-318ac972"]]);export{Ht as default};
