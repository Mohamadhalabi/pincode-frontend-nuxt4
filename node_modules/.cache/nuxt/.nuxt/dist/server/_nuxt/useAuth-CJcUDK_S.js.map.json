{"file":"useAuth-CJcUDK_S.js","mappings":";;AAOA,SAAS,YAAY,KAAgB;AAEnC,SAAO,KAAK,QAAQ,KAAK,MAAM,QAAQ,KAAK,QAAQ,OAAO;AAC7D;AAEO,SAAS,UAAU;AACxB,QAAM,EAAE,KAAA,IAAS,WAAA;AAEjB,QAAM,QAAQ,SAAS,QAAQ,MAAM;AACnC,QAAI,SAAe;AAInB,WAAO,EAAE,MAAM,QAAgB,OAAO,MAAA;AAAA,EACxC,CAAC;AASD,QAAM,UAAU,CAAC,MAAY;AAC3B,UAAM,MAAM,OAAO;AAAA,EAKrB;AAEA,QAAM,WAAW,YAAY;AAC3B,QAAI;AACF,YAAM,MAAW,MAAM,KAAK,OAAO,EAAE,QAAQ,OAAO;AACpD,cAAQ,YAAY,GAAG,CAAC;AAAA,IAC1B,QAAQ;AAAE,cAAQ,IAAI;AAAA,IAAE;AAAA,EAC1B;AAQA,QAAM,QAAQ,OAAO,gBAAqB,kBAA2B;AACnE,UAAM,UAAU,OAAO,mBAAmB,WACtC,EAAE,OAAO,gBAAgB,UAAU,cAAA,IACnC;AAEJ,UAAM,MAAW,MAAM,KAAK,eAAe,EAAE,QAAQ,QAAQ,MAAM,SAAS;AAClE,SAAK,SAAS,KAAK,MAAM;AAInC,UAAM,IAAI,YAAY,GAAG;AACzB,QAAI,WAAW,CAAC;AAAA,eACL,SAAA;AAEX,WAAO,MAAM,MAAM;AAAA,EACrB;AAEA,QAAM,WAAW,OAAO,YAAiB;AACvC,UAAM,MAAW,MAAM,KAAK,kBAAkB,EAAE,QAAQ,QAAQ,MAAM,SAAS;AACrE,SAAK,SAAS,KAAK,MAAM;AAGnC,UAAM,IAAI,YAAY,GAAG;AACzB,QAAI,WAAW,CAAC;AAAA,eACL,SAAA;AAEX,WAAO,MAAM,MAAM;AAAA,EACrB;AAEA,QAAM,SAAS,YAAY;AACzB,QAAI;AAAE,YAAM,KAAK,gBAAgB,EAAE,QAAQ,QAAQ;AAAA,IAAE,QAAQ;AAAA,IAAC;AAC9C,YAAQ,IAAI;AAAA,EAC9B;AAEA,SAAO;AAAA,IACL,MAAM,SAAS,MAAM,MAAM,MAAM,IAAI;AAAA,IACrC,OAAO,SAAS,MAAM,MAAM,MAAM,KAAK;AAAA,IACvC,YAAY,SAAS,MAAM,CAAC,CAAC,MAAM,MAAM,QAAQ,KAAS;AAAA,IAC1D;AAAA,IAAO;AAAA,IAAU;AAAA,IAAQ,YAAY;AAAA,EAAA;AAEzC;","names":[],"sources":["../../../../../../../composables/useAuth.ts"],"sourcesContent":["// composables/useAuth.ts\nimport { computed, onMounted } from 'vue'\n\ntype User = Record<string, any> | null\nconst TOKEN_KEY = 'auth_token'\nconst USER_KEY  = 'auth_user'\n\nfunction extractUser(res: any): User {\n  // Handle: {user:{...}}, {data:{user:{...}}}, {data:{...}}, or plain user object\n  return res?.user ?? res?.data?.user ?? res?.data ?? res ?? null\n}\n\nexport function useAuth() {\n  const { $api } = useNuxtApp() as any\n\n  const state = useState('auth', () => {\n    let cached: User = null\n    if (process.client) {\n      try { cached = JSON.parse(localStorage.getItem(USER_KEY) || 'null') } catch {}\n    }\n    return { user: cached as User, ready: false }\n  })\n\n  const token = () => (process.client ? localStorage.getItem(TOKEN_KEY) : null)\n  const setToken = (t?: string | null) => {\n    if (!process.client) return\n    if (t) localStorage.setItem(TOKEN_KEY, t)\n    else localStorage.removeItem(TOKEN_KEY)\n  }\n\n  const setUser = (u: User) => {\n    state.value.user = u\n    if (process.client) {\n      if (u) localStorage.setItem(USER_KEY, JSON.stringify(u))\n      else localStorage.removeItem(USER_KEY)\n    }\n  }\n\n  const loadUser = async () => {\n    try {\n      const res: any = await $api('/me', { method: 'GET' })\n      setUser(extractUser(res))\n    } catch { setUser(null) }\n  }\n\n  onMounted(async () => {\n    if (state.value.ready) return\n    if (token() && !state.value.user) await loadUser()\n    state.value.ready = true\n  })\n\n  const login = async (payloadOrEmail: any, maybePassword?: string) => {\n    const payload = typeof payloadOrEmail === 'string'\n      ? { email: payloadOrEmail, password: maybePassword }\n      : payloadOrEmail\n\n    const res: any = await $api('/auth/login', { method: 'POST', body: payload })\n    const t = res?.token || res?.data?.token\n    if (t) setToken(t)\n\n    // If backend already returned user, set it immediately; otherwise fetch /me\n    const u = extractUser(res)\n    if (u) setUser(u)\n    else await loadUser()\n\n    return state.value.user\n  }\n\n  const register = async (payload: any) => {\n    const res: any = await $api('/auth/register', { method: 'POST', body: payload })\n    const t = res?.token || res?.data?.token\n    if (t) setToken(t)\n\n    const u = extractUser(res)\n    if (u) setUser(u)\n    else await loadUser()\n\n    return state.value.user\n  }\n\n  const logout = async () => {\n    try { await $api('/auth/logout', { method: 'POST' }) } catch {}\n    setToken(null); setUser(null)\n  }\n\n  return {\n    user: computed(() => state.value.user),\n    ready: computed(() => state.value.ready),\n    isLoggedIn: computed(() => !!state.value.user || !!token()),\n    login, register, logout, reloadUser: loadUser,\n  }\n}\n"],"version":3}