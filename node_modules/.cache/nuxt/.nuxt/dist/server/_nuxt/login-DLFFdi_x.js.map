{"version":3,"file":"login-DLFFdi_x.js","sources":["../../../../../../../pages/login.vue"],"sourcesContent":["<script setup lang=\"ts\">\nconst { t } = useI18n()\nconst router = useRouter()\nconst { $api } = useNuxtApp()\n\nconst auth = (typeof useAuth === 'function' ? useAuth() : null) as any\nconst cart = useCart()\n\n/** Login */\nconst loginForm = reactive({ email: '', password: '' })\nconst loadingLogin = ref(false)\nconst errLogin = ref<string | null>(null)\nconst showLoginPass = ref(false)\n\n/** Register */\nconst regForm = reactive({\n  first_name: '', last_name: '', email: '', password: '', password_confirmation: ''\n})\nconst loadingRegister = ref(false)\nconst errRegister = ref<string | null>(null)\nconst showRegPass = ref(false)\n\n/** Merge guest cart after auth */\nasync function mergeGuestCartToServer() {\n  const guestItems = cart.snapshot()\n  if (!guestItems.length) return\n  try {\n    await $api('/cart/merge', { method: 'POST', body: { items: guestItems } })\n  } catch {}\n  try {\n    const res = await $api('/cart', { method: 'GET' })\n    cart.replace(Array.isArray(res?.items) ? res.items : [])\n  } catch { cart.clear() }\n}\n\n// pages/login.vue (script)\n// pages/login.vue\nasync function submitLogin() {\n  errLogin.value = null; loadingLogin.value = true\n  try {\n    await auth.login({ email: loginForm.email, password: loginForm.password }) // <-- object!\n    await cart.afterAuthSync()\n    router.push('/')\n  } catch (e:any) {\n    errLogin.value = e?.data?.message || e?.message || 'Login failed'\n  } finally {\n    loadingLogin.value = false\n  }\n}\n\n\n\n\nasync function submitRegister() {\n  errRegister.value = null\n  if (regForm.password !== regForm.password_confirmation) {\n    errRegister.value = (t('auth.passwordsNotMatch') as string) || 'Passwords do not match'\n    return\n  }\n  loadingRegister.value = true\n  try {\n    if (auth && typeof auth.register === 'function') {\n      // Preferred path: your composable implements register\n      await auth.register({ ...regForm, device: 'web' })\n    } else {\n      // Fallback: call backend directly, then log in\n      await $api('/auth/register', { method: 'POST', body: { ...regForm, device: 'web' } })\n      if (auth && typeof auth.login === 'function') {\n        await auth.login(regForm.email, regForm.password)\n      }\n    }\n    await mergeGuestCartToServer()\n    router.push('/')\n  } catch (e:any) {\n    errRegister.value = e?.data?.message || e?.message || (t('auth.registerFailed') as string) || 'Registration failed'\n  } finally {\n    loadingRegister.value = false\n  }\n}\n</script>\n\n<template>\n  <div class=\"max-w-5xl mx-auto px-4 py-10\">\n    <!-- Breadcrumb -->\n    <nav class=\"flex items-center text-sm text-gray-500 mb-6\" aria-label=\"Breadcrumb\">\n      <NuxtLink to=\"/\" class=\"hover:text-orange-500\">{{ t('common.home') || 'Home' }}</NuxtLink>\n      <span class=\"mx-2\">›</span>\n      <span class=\"text-gray-800 font-medium\">{{ t('auth.login') || 'Login' }}</span>\n    </nav>\n\n    <!-- Title -->\n    <h1 class=\"text-2xl sm:text-3xl font-bold mb-8\">{{ t('auth.login') }}</h1>\n\n    <!-- Forms container -->\n    <div class=\"bg-white rounded-2xl border shadow-sm\">\n      <div class=\"grid lg:grid-cols-[1fr_auto_1fr]\">\n        <!-- Login -->\n        <section class=\"p-6 sm:p-8\">\n          <h2 class=\"text-xl font-semibold mb-4\">{{ t('auth.login') || 'Login' }}</h2>\n\n          <form class=\"space-y-4\" @submit.prevent=\"submitLogin\">\n            <div>\n              <label class=\"block text-sm text-gray-700 mb-1\">{{ t('common.email') || 'Email' }}</label>\n              <input v-model.trim=\"loginForm.email\" type=\"email\" required\n                     class=\"w-full rounded-xl border px-3 py-2 focus:outline-none focus:ring-2 focus:ring-orange-400\" />\n            </div>\n            <div>\n              <label class=\"block text-sm text-gray-700 mb-1\">{{ t('auth.password') || 'Password' }}</label>\n              <div class=\"relative\">\n                <input :type=\"showLoginPass ? 'text' : 'password'\" v-model=\"loginForm.password\" required\n                       class=\"w-full rounded-xl border px-3 py-2 pr-10 focus:outline-none focus:ring-2 focus:ring-orange-400\" />\n                <button type=\"button\" class=\"absolute inset-y-0 right-2 my-auto text-gray-500\"\n                        @click=\"showLoginPass = !showLoginPass\">\n                  <span :class=\"showLoginPass ? 'i-lucide:eye-off' : 'i-lucide:eye'\"></span>\n                </button>\n              </div>\n            </div>\n\n            <button class=\"btn w-full\" :disabled=\"loadingLogin\">\n              <span v-if=\"!loadingLogin\">{{ t('auth.login') || 'Login' }}</span>\n              <span v-else>{{ t('common.loading') || 'Loading…' }}</span>\n            </button>\n\n            <p v-if=\"errLogin\" class=\"text-red-600 text-sm\">{{ errLogin }}</p>\n          </form>\n        </section>\n\n        <!-- Divider -->\n        <div class=\"relative\">\n          <div class=\"hidden lg:block w-px h-full bg-gray-200\" />\n          <div class=\"lg:hidden h-px w-full bg-gray-200\" />\n          <div class=\"hidden lg:flex absolute top-1/2 -translate-y-1/2 left-1/2 -translate-x-1/2\">\n            <span class=\"text-xs text-gray-500 bg-white px-2\">OR</span>\n          </div>\n          <div class=\"lg:hidden flex justify-center\">\n            <span class=\"text-xs text-gray-500 bg-white px-2 -mt-3\">OR</span>\n          </div>\n        </div>\n\n        <!-- Register -->\n        <section class=\"p-6 sm:p-8\">\n          <h2 class=\"text-xl font-semibold mb-4\">{{ t('auth.register') || 'Register' }}</h2>\n\n          <form class=\"space-y-4\" @submit.prevent=\"submitRegister\">\n            <div class=\"grid sm:grid-cols-2 gap-3\">\n              <div>\n                <label class=\"block text-sm text-gray-700 mb-1\">{{ t('auth.firstName') || 'First name' }}</label>\n                <input v-model.trim=\"regForm.first_name\" type=\"text\" required\n                       class=\"w-full rounded-xl border px-3 py-2 focus:outline-none focus:ring-2 focus:ring-orange-400\" />\n              </div>\n              <div>\n                <label class=\"block text-sm text-gray-700 mb-1\">{{ t('auth.lastName') || 'Last name' }}</label>\n                <input v-model.trim=\"regForm.last_name\" type=\"text\" required\n                       class=\"w-full rounded-xl border px-3 py-2 focus:outline-none focus:ring-2 focus:ring-orange-400\" />\n              </div>\n            </div>\n\n            <div>\n              <label class=\"block text-sm text-gray-700 mb-1\">{{ t('common.email') || 'Email' }}</label>\n              <input v-model.trim=\"regForm.email\" type=\"email\" required\n                     class=\"w-full rounded-xl border px-3 py-2 focus:outline-none focus:ring-2 focus:ring-orange-400\" />\n            </div>\n\n            <div>\n              <label class=\"block text-sm text-gray-700 mb-1\">{{ t('auth.password') || 'Password' }}</label>\n              <div class=\"relative\">\n                <input :type=\"showRegPass ? 'text' : 'password'\" v-model=\"regForm.password\" required minlength=\"6\"\n                       class=\"w-full rounded-xl border px-3 py-2 pr-10 focus:outline-none focus:ring-2 focus:ring-orange-400\" />\n                <button type=\"button\" class=\"absolute inset-y-0 right-2 my-auto text-gray-500\"\n                        @click=\"showRegPass = !showRegPass\">\n                  <span :class=\"showRegPass ? 'i-lucide:eye-off' : 'i-lucide:eye'\"></span>\n                </button>\n              </div>\n            </div>\n\n            <div>\n              <label class=\"block text-sm text-gray-700 mb-1\">{{ t('auth.confirmPassword') || 'Confirm password' }}</label>\n              <input :type=\"showRegPass ? 'text' : 'password'\" v-model=\"regForm.password_confirmation\" required minlength=\"6\"\n                     class=\"w-full rounded-xl border px-3 py-2 focus:outline-none focus:ring-2 focus:ring-orange-400\" />\n            </div>\n\n            <button class=\"btn w-full\" :disabled=\"loadingRegister\">\n              <span v-if=\"!loadingRegister\">{{ t('auth.createAccount') || 'Create account' }}</span>\n              <span v-else>{{ t('common.loading') || 'Loading…' }}</span>\n            </button>\n\n            <p v-if=\"errRegister\" class=\"text-red-600 text-sm\">{{ errRegister }}</p>\n          </form>\n        </section>\n      </div>\n    </div>\n  </div>\n</template>\n\n<style>\n.btn { @apply inline-flex items-center justify-center rounded-xl bg-orange-500 text-white px-4 py-2 hover:bg-orange-600 transition; }\n</style>\n"],"names":["_ssrRenderAttrs","_mergeProps","_push","_parent","_unref","_ssrRenderAttr"],"mappings":"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"}