{"file":"_slug_-BJbmDp7S.js","mappings":"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","names":["_ssrRenderAttrs","_mergeProps","_unref","_ssrInterpolate","_ssrIncludeBooleanAttr"],"sources":["../../../../../../../pages/services/[slug].vue"],"sourcesContent":["<script setup lang=\"ts\">\nconst { t, locale } = useI18n()\nconst route = useRoute()\nconst router = useRouter()\nconst { $api } = useNuxtApp()\n\nconst slug = computed(() => route.params.slug as string)\n\nconst service = ref<any | null>(null)\nconst loading = ref(false)\nconst error = ref<string | null>(null)\n\n// result coming from API (vin / key_code / pin_code)\nconst result = ref<{\n  vin: string | null\n  key_code: string | null\n  pin_code: string | null\n} | null>(null)\n\n// dynamic form inputs: { vin: '', ... } — always LOWERCASE keys\nconst form = reactive<Record<string, string>>({})\n\n// normalize VIN live (uppercase + O->0)\nwatch(\n  () => form.vin,\n  (val) => {\n    if (!val) return\n\n    let updated = val.toUpperCase()\n    updated = updated.replace(/O/gi, '0')\n\n    if (updated !== val) {\n      form.vin = updated\n    }\n  }\n)\n\nconst submitting = ref(false)\nconst submitError = ref<string | null>(null)\nconst submitSuccess = ref<string | null>(null)\n\n// copy result status\nconst copyStatus = ref<'idle' | 'copied'>('idle')\n\nconst auth = (typeof useAuth === 'function' ? useAuth() : null) as any\nconst user = computed(() => auth?.user?.value || null)\nconst clientToken = process.client ? localStorage.getItem('auth_token') : null\n\nconst walletTokens = computed(() => Number(service.value?.wallet_tokens || 0))\nconst costTokens   = computed(() => Number(service.value?.cost_tokens || 0))\nconst behavior     = computed(() => service.value?.behavior || 'decoder')\n\nconst canSubmit = computed(() => {\n  if (!service.value) return false\n  if (walletTokens.value < costTokens.value) return false\n\n  const required: string[] = service.value.required_inputs || []\n\n  for (const rawKey of required) {\n    const fieldKey = rawKey.toLowerCase()\n    const val = (form[fieldKey] || '').trim()\n    if (!val) return false\n\n    if (fieldKey === 'vin' && val.length !== 17) return false\n  }\n\n  return true\n})\n\n// true when backend sent decoder.vin_unavailable (502 case)\nconst isVinUnavailableError = computed(() => {\n  if (!submitError.value) return false\n  return submitError.value === (t('decoder.vin_unavailable') as string)\n})\n\nonMounted(async () => {\n  if (!user.value && !clientToken) {\n    router.push('/login?redirect=' + encodeURIComponent(route.fullPath))\n    return\n  }\n\n  await fetchService()\n})\n\nasync function fetchService() {\n  loading.value = true\n  error.value = null\n  try {\n    const res: any = await $api(`/services/${slug.value}`, { method: 'GET' })\n    service.value = res\n\n    const required: string[] = res.required_inputs || []\n    required.forEach((rawKey) => {\n      const fieldKey = rawKey.toLowerCase()\n      if (!(fieldKey in form)) form[fieldKey] = ''\n    })\n  } catch (e: any) {\n    console.error(e)\n    error.value = e?.data?.message || e?.message || 'Failed to load service'\n  } finally {\n    loading.value = false\n  }\n}\n\nasync function submitLookup() {\n  if (!service.value) return\n\n  submitError.value = null\n  submitSuccess.value = null\n  submitting.value = true\n  result.value = null\n  copyStatus.value = 'idle'\n\n  try {\n    const normalizedInputs: Record<string, string> = {}\n    const entries = Object.entries(form)\n\n    entries.forEach(([key, value]) => {\n      const k = key.toLowerCase()\n      let v = String(value || '').trim()\n      if (k === 'vin') {\n        v = v.toUpperCase().replace(/O/gi, '0')\n      }\n      normalizedInputs[k] = v\n    })\n\n    const payload: any = {\n      service_category_id: service.value.id,\n      input_payload: normalizedInputs,\n    }\n\n    const res: any = await $api(`/vin-lookups?locale=${locale.value}`, {\n      method: 'POST',\n      body: payload,\n    })\n\n    submitSuccess.value =\n      res?.message ||\n      (t('service.submit.success') as string) ||\n      'Lookup submitted successfully.'\n\n    result.value = {\n      vin: res?.vin ?? null,\n      key_code: res?.key_code ?? null,\n      pin_code: res?.pin_code ?? null,\n    }\n\n    Object.keys(form).forEach((k) => (form[k] = ''))\n\n    await fetchService()\n  } catch (e: any) {\n    console.error(e)\n    submitError.value =\n      e?.data?.message ||\n      e?.message ||\n      (t('service.submit.error') as string) ||\n      'Failed to submit lookup.'\n  } finally {\n    submitting.value = false\n  }\n}\n\n// Open WhatsApp with a pre-filled message\nfunction openWhatsapp() {\n  const rawNumber = '+971504429045'\n  const digitsOnly = rawNumber.replace(/\\D/g, '')\n\n  const lines = [\n    'PIN Code request',\n    service.value?.name ? `Service: ${service.value.name}` : '',\n    form.vin ? `VIN: ${form.vin}` : '',\n  ].filter(Boolean)\n\n  const url = `https://wa.me/${digitsOnly}?text=${encodeURIComponent(\n    lines.join('\\n')\n  )}`\n\n  if (process.client) {\n    window.open(url, '_blank')\n  }\n}\n\n// Copy VIN / KEYCODE / PINCODE to clipboard\nasync function copyResult() {\n  if (!result.value) return\n\n  const parts: string[] = []\n\n  if (result.value.vin) {\n    parts.push(`VIN: ${result.value.vin}`)\n  }\n  if (result.value.key_code) {\n    parts.push(`KEYCODE: ${result.value.key_code}`)\n  }\n  if (result.value.pin_code) {\n    parts.push(`PINCODE: ${result.value.pin_code}`)\n  }\n\n  const text = parts.join('\\n')\n\n  try {\n    await navigator.clipboard.writeText(text)\n    copyStatus.value = 'copied'\n    setTimeout(() => {\n      copyStatus.value = 'idle'\n    }, 2000)\n  } catch (err) {\n    console.error('Clipboard error', err)\n  }\n}\n</script>\n\n<template>\n  <div class=\"max-w-3xl mx-auto px-4 py-8\">\n    <div v-if=\"loading\" class=\"text-center text-gray-500\">\n      {{ t('common.loading') || 'Loading…' }}\n    </div>\n    <div\n      v-else-if=\"error\"\n      class=\"rounded-xl bg-red-50 text-red-700 px-3 py-2 mb-4 text-sm\"\n    >\n      {{ error }}\n    </div>\n\n    <template v-else-if=\"service\">\n      <h1 class=\"text-2xl sm:text-3xl font-bold mb-2\">\n        {{ service.name }}\n      </h1>\n\n      <div class=\"grid gap-4 sm:grid-cols-2 mb-6\">\n        <div class=\"rounded-2xl border bg-white p-4\">\n          <div class=\"text-xs text-gray-500 mb-1\">\n            {{ t('service.walletTokens') || 'Available Tokens' }}\n          </div>\n          <div class=\"text-2xl font-bold\">\n            {{ walletTokens }}\n          </div>\n        </div>\n        <div class=\"rounded-2xl border bg-white p-4\">\n          <div class=\"text-xs text-gray-500 mb-1\">\n            {{ t('service.costTokens') || 'Required Tokens' }}\n          </div>\n          <div class=\"text-2xl font-bold\">\n            {{ costTokens }}\n          </div>\n        </div>\n      </div>\n\n      <div class=\"rounded-2xl border bg-white p-4 mb-6\">\n        <h2 class=\"text-sm font-semibold mb-2\">\n          {{ t('service.instructions') || 'Instructions' }}\n        </h2>\n        <pre class=\"whitespace-pre-wrap text-sm text-gray-700\">\n{{ service.instruction_md || t('service.instructionsEmpty') || 'No instructions yet.' }}\n        </pre>\n      </div>\n\n      <div\n        v-if=\"behavior === 'whatsapp' && service.whatsapp_number\"\n        class=\"rounded-xl border border-green-200 bg-green-50 px-3 py-2 mb-4 text-xs text-green-800\"\n      >\n        {{ t('service.whatsappHint') || 'This service is processed via WhatsApp.' }}\n        <br />\n        {{ t('service.whatsappNumber') || 'WhatsApp number:' }}\n        <strong>{{ service.whatsapp_number }}</strong>\n      </div>\n\n      <div class=\"rounded-2xl border bg-white p-4\">\n        <h2 class=\"text-sm font-semibold mb-3\">\n          {{ t('service.requestTitle') || 'Request' }}\n        </h2>\n\n        <form class=\"space-y-3\" @submit.prevent=\"submitLookup\">\n          <div\n            v-for=\"rawKey in service.required_inputs || []\"\n            :key=\"rawKey\"\n          >\n            <label class=\"block text-md text-gray-600 mb-1\">\n              <span class=\"text-red-600\">*</span>{{ rawKey.toUpperCase() }}\n            </label>\n            <input\n              v-model.trim=\"form[rawKey.toLowerCase()]\"\n              type=\"text\"\n              :maxlength=\"rawKey.toLowerCase() === 'vin' ? 17 : null\"\n              :minlength=\"rawKey.toLowerCase() === 'vin' ? 17 : null\"\n              class=\"w-full rounded-xl border px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-orange-400\"\n              required\n            />\n            <p\n              v-if=\"\n                rawKey.toLowerCase() === 'vin' &&\n                form[rawKey.toLowerCase()] &&\n                form[rawKey.toLowerCase()].length > 0 &&\n                form[rawKey.toLowerCase()].length !== 17\n              \"\n              class=\"mt-1 text-xs text-red-600\"\n            >\n              {{ t('service.vin_size') || 'VIN must be exactly 17 characters.' }}\n            </p>\n          </div>\n\n          <!-- Error block: special UI when VIN unavailable (502) -->\n          <div v-if=\"submitError\" class=\"mt-2\">\n            <div\n              v-if=\"isVinUnavailableError\"\n              class=\"rounded-xl bg-red-50 border border-red-200 text-red-700 px-3 py-2 text-xs space-y-2\"\n            >\n              <div>{{ submitError }}</div>\n              <button\n                type=\"button\"\n                class=\"inline-flex items-center rounded-lg bg-green-500 text-white px-3 py-1 text-xs font-medium hover:bg-green-600\"\n                @click=\"openWhatsapp\"\n              >\n                {{ t('common.contact_whatsapp') || 'Contact us on WhatsApp' }}\n              </button>\n            </div>\n            <div\n              v-else\n              class=\"text-xs text-red-600\"\n            >\n              {{ submitError }}\n            </div>\n          </div>\n\n          <div v-if=\"submitSuccess\" class=\"text-xs text-emerald-600 mt-1\">\n            {{ submitSuccess }}\n          </div>\n\n          <button\n            type=\"submit\"\n            class=\"mt-2 inline-flex items-center justify-center rounded-xl bg-orange-500 text-white px-4 py-2 text-sm font-medium hover:bg-orange-600 transition disabled:opacity-50 disabled:cursor-not-allowed\"\n            :disabled=\"submitting || !canSubmit\"\n          >\n            <span v-if=\"!submitting\">\n              {{ t('service.submit') || 'Submit Request' }}\n            </span>\n            <span v-else>\n              {{ t('common.loading') || 'Submitting…' }}\n            </span>\n          </button>\n\n          <p\n            v-if=\"walletTokens < costTokens\"\n            class=\"mt-2 text-xs text-red-600\"\n          >\n            {{\n              t('service.notEnoughTokens') ||\n                'You don’t have enough tokens for this service.'\n            }}\n          </p>\n        </form>\n\n        <!-- Result card with copy button -->\n        <div\n          v-if=\"result && (result.vin || result.pin_code || result.key_code)\"\n          class=\"mt-4 rounded-2xl border border-emerald-200 bg-emerald-50 px-4 py-3 text-sm text-emerald-800\"\n        >\n          <div class=\"flex items-center justify-between mb-1\">\n            <div class=\"font-semibold\">\n              {{ t('service.resultTitle') || 'Decoded Result' }}\n            </div>\n            <button\n              type=\"button\"\n              class=\"text-xs font-medium underline underline-offset-2\"\n              @click=\"copyResult\"\n            >\n              {{\n                copyStatus === 'copied'\n                  ? t('common.copied') || 'Copied'\n                  : t('common.copy') || 'Copy'\n              }}\n            </button>\n          </div>\n\n          <div v-if=\"result.vin\">\n            <strong>{{ result.vin }}</strong>\n          </div>\n          <div v-if=\"result.key_code\">\n            <strong>{{ result.key_code }}</strong>\n          </div>\n          <div v-if=\"result.pin_code\">\n            <strong>{{ result.pin_code }}</strong>\n          </div>\n        </div>\n      </div>\n    </template>\n  </div>\n</template>\n"],"version":3}